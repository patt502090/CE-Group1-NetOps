# /etc/freeradius/radiusd.conf
# FreeRADIUS Main Configuration — Group 1 NetOps
#
# NOTE: นี่คือ minimal config สำหรับ reference
# Production ควรใช้ default config แล้ว override เฉพาะส่วนที่ต้องการ

prefix = /usr
exec_prefix = /usr
sysconfdir = /etc
localstatedir = /var
sbindir = ${exec_prefix}/sbin
logdir = /var/log/freeradius
raddbdir = /etc/freeradius
radacctdir = ${logdir}/radacct
run_dir = ${localstatedir}/run/freeradius

# --- Logging ---
log {
    destination = stdout       # Docker-friendly: log to stdout
    colourise = yes
    file = ${logdir}/radius.log
    syslog_facility = daemon
    stripped_names = no
    auth = yes                 # Log authentication requests
    auth_badpass = yes         # Log failed passwords (debug)
    auth_goodpass = no         # Don't log successful passwords
}

# --- Security ---
security {
    max_attributes = 200
    reject_delay = 1
    status_server = yes
}

# --- Thread Pool ---
thread pool {
    start_servers = 5
    max_servers = 32
    min_spare_servers = 3
    max_spare_servers = 10
    max_requests_per_server = 0
}

# --- Module / Site includes ---
$INCLUDE clients.conf

# Load modules
modules {
    $INCLUDE mods-enabled/
}

# Load virtual servers (sites)
server default {
    listen {
        type = auth
        ipaddr = *
        port = 1812
    }

    listen {
        type = acct
        ipaddr = *
        port = 1813
    }

    authorize {
        filter_username
        eap {
            ok = return
        }
        # ntlm_auth module — authenticate ผ่าน Samba4 AD
        # mschap
    }

    authenticate {
        eap
        # mschap
    }

    post-auth {
        # VLAN Assignment ตาม AD Group
        # if (LDAP-Group == "staff") {
        #     update reply {
        #         Tunnel-Type := VLAN
        #         Tunnel-Medium-Type := IEEE-802
        #         Tunnel-Private-Group-Id := "30"
        #     }
        # }
    }
}
